---
output:
  github_document
---


```{r, echo = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "README-"
)
options(width = 110)

```

# socsci <img src="man/figures/logo.png" align="right" height="120" />

<!-- badges: start -->
<!-- badges: end -->

**Tidyverse-friendly tools for survey analysis.** Weighted crosstabs, confidence intervals, and factor recoding — all in a few keystrokes.

## Author

Ryan Burge — <https://www.ryanburge.net>
Reference site: <https://ryanburge.github.io/socsci/>

Professor of Practice, Washington University in St. Louis

------

## Installation

```R
install.packages("devtools")
devtools::install_github("ryanburge/socsci")
```

## Core Functions

| Function | Purpose |
|----------|---------|
| `ct()` | Count & tabulate with percentages (weighted or unweighted) |
| `mean_ci()` | Mean with confidence interval (weighted, Kish n_eff) |
| `frcode()` | Recode via `case_when()` and keep factor level order |
| `corr()` | Correlation test with tidy output |
| `mean_med()` | Quick mean and median |
| `bind_df()` | Row-bind data frames matching a name pattern |
| `xbar()` | Crosstab stacked bar chart |
| `xheat()` | Crosstab heatmap |


## Counting Things with `ct()`

A weighted replacement for `janitor::tabyl()`. Respects existing `group_by()`, supports NA filtering, sorting, and cumulative totals.

```{r, warning = FALSE, message = FALSE}
library(socsci)

df <- tibble::tibble(
  race   = c("White", "Black", "Hispanic", "Asian", NA, "White", "Black"),
  weight = c(1, 1.2, 0.8, 1.5, 1, 1, 0.9)
)

# Unweighted
df %>% ct(race)

# Weighted
df %>% ct(race, wt = weight)

# Exclude NAs before computing pct
df %>% ct(race, show_na = FALSE)

# Cumulative totals (sorted by frequency)
df %>% ct(race, wt = weight, show_na = FALSE, cum = TRUE, sort = TRUE)
```

`ct()` respects existing groups, so within-group percentages just work:

```{r, warning = FALSE, message = FALSE}
df_grouped <- tibble::tibble(
  region = c("South", "South", "South", "North", "North", "North"),
  party  = c("Dem", "Rep", "Dem", "Dem", "Rep", "Rep")
)

df_grouped %>%
  dplyr::group_by(region) %>%
  ct(party)
```


## Confidence Intervals with `mean_ci()`

Computes mean, SD, standard error, and CI bounds. Supports survey weights (Kish effective sample size) and both t and normal critical values.

```{r, warning = FALSE, message = FALSE}
set.seed(1)
df2 <- tibble::tibble(
  x  = c(rnorm(8, 10, 2), NA_real_),
  w  = c(1, 2, 1, 1, 2, 1, 1, 3, 1)
)

# Unweighted, 95% CI (t critical)
mean_ci(df2, x)

# Weighted, 95% CI
mean_ci(df2, x, wt = w)

# Unweighted, 90% CI (normal critical)
mean_ci(df2, x, ci = 0.90, dist = "normal")
```

Works with `group_by()` for easy comparisons:

```{r, warning = FALSE, message = FALSE}
mtcars %>%
  dplyr::group_by(cyl) %>%
  mean_ci(mpg)
```


## Recoding with `frcode()`

Wraps `dplyr::case_when()` but returns a factor with levels in the order you write them — no more alphabetical sorting messing up your plots.

```{r, warning = FALSE, message = FALSE, fig.width= 12, fig.show="hide"}
df3 <- tibble::tibble(
  pid7 = c(1,2,3,4,5,6,7, NA, 4, 2)
)

df3 %>%
  dplyr::mutate(
    pid_new = frcode(
      pid7 == 1 ~ "Strong Democrat",
      pid7 == 2 ~ "Not Strong Democrat",
      pid7 == 3 ~ "Lean Democrat",
      pid7 == 4 ~ "Independent",
      pid7 == 5 ~ "Lean Republican",
      pid7 == 6 ~ "Not Strong Republican",
      pid7 == 7 ~ "Strong Republican",
      TRUE ~ NA_character_
    )
  ) %>%
  ct(pid_new, show_na = FALSE)
```


## Correlation with `corr()`

Tidy one-liner for Pearson correlation with p-value and confidence interval.

```{r, warning = FALSE, message = FALSE}
mtcars %>% corr(mpg, wt)
```


## Mean & Median with `mean_med()`

Quick summary when you just need the center.

```{r, warning = FALSE, message = FALSE}
mtcars %>% mean_med(mpg)
```


## Visualization: `xbar()` and `xheat()`

Quick crosstab plots (requires `ggplot2` and `scales`):

```{r xbar-example, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 5}
mtcars %>% xbar(cyl, am)
```

```{r xheat-example, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 5}
mtcars %>% xheat(cyl, am, count = TRUE)
```
